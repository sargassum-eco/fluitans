{{template "shared/base.layout.tmpl" .}}

{{define "title"}}Login{{end}}
{{define "description"}}Log in to Fluitans.{{end}}

{{define "content"}}
  <main class="main-container">
    <section class="section content">
      <h1>Login</h1>
      {{range $message := .Data.ErrorMessages}}
        <article class="message is-danger card section-card is-block">
          <div class="message-header">
            <p>Error</p>
          </div>
          <div class="message-body">
            {{$message}}
          </div>
        </article>
      {{end}}
      {{if .Data.NoAuth}}
        <div class="message is-danger card section-card is-block">
          <div class="message-header">
            <p>Security Warning</p>
          </div>
          <div class="message-body">
            This server was started with authentication disabled, so everyone has can log in as admin
            with a blank username and password!
          </div>
        </div>
      {{end}}
      {{if .Auth.Identity.Authenticated}}
        <article class="message is-success card section-card is-block">
          <div class="message-body">
            <p class="mb-4">You are already logged in as {{.Auth.Identity.User}}!</p>
            <form
              action="/sessions"
              method="POST"
              data-turbo-frame="_top"
              data-controller="form-submission turbo-cache"
              data-action="submit->form-submission#submit submit->turbo-cache#clear"
              data-form-submission-target="submitter"
            >
              <input type="hidden" name="method" value="DELETE">
              <div class="field">
                <div class="control" data-form-submission-target="submitter">
                  <input
                    type="submit"
                    class="button is-primary"
                    value="Log Out"
                    data-form-submission-target="submit"
                  >
                </div>
              </div>
            </form>
          </div>
        </article>
      {{else}}
        <div class="card section-card is-block">
          <div class="card-content">
            {{if .Auth.Identity.Authenticated}}
            {{else}}
              <form
                action="/sessions"
                method="POST"
                data-turbo-frame="_top"
                data-controller="form-submission turbo-cache"
                data-action="submit->form-submission#submit submit->turbo-cache#clear"
                data-form-submission-target="submitter"
              >
                <input type="hidden" name="method" value="AUTHENTICATE">
                <input type="hidden" name="return" value="{{.Data.ReturnURL}}">
                <div class="field">
                  <label class="label" for="username">Username</label>
                  <div class="control">
                    <input class="input" type="text" id="username" name="username" autofocus>
                  </div>
                </div>
                <div class="field">
                  <label class="label" for="password">Password</label>
                  <div class="control">
                    <input class="input" type="password" id="password" name="password">
                  </div>
                </div>
                <div class="field">
                  <div class="control" data-form-submission-target="submitter">
                    <input
                    type="submit"
                    class="button is-primary"
                    value="Sign in"
                    data-form-submission-target="submit"
                  >
                  </div>
                </div>
              </form>
            {{end}}
          </div>
        </div>
      {{end}}
    </section>
  </main>
{{end}}
